Комплект поставки:
1. Установочный пакет для центрального офиса (SqlPlusDbSync.Server.Setup.msi)
2. Установочный пакет для аптечной базы (SqlPlusDbSync.Client.Setup.msi)
3. Установочный пакет сервера сообщений (rabbitmq-server-3.6.10.exe)
4. Установочный пакет .NET Framework 4 (dotNetFx40_Full_x86_x64.exe)
5. Патч для .NET Framework 4 KB2468871 (только для Windows XP) (NDP40-KB2468871-v2-IA64.exe) 

Инструкция по установке:

1. Установить сервер RabbitMQ. Скачать его можно отсюда - http://www.rabbitmq.com/download.html. Всё тестирование проходило на версии 3.6.10. Сервер сообщений можно установить на выделеном сервере, для большего распределения нагрузки.

2. Для сервера RabbitMQ необходимо создать пользователя, под которым будет заходить сервер сообщений. Чтобы сделать это, необходимо открыть консоль управления RabbitMQ. 
Дальше представлена инструкция открытия консоли для семейства ОС Windows NT.
Откройте программу cmd.
Выполните команду cd C:\Program Files\RabbitMQ Server\rabbitmq_server-3.6.10\sbin (если версия сервера сообщений отлична от 3.6.10, необходимо изменить путь).

Далее выполните следующие команды:
Где, YOUR_USERNAME - имя пользователя, YOUR_PASSWORD - пароль 
rabbitmqctl add_user YOUR_USERNAME YOUR_PASSWORD
rabbitmqctl set_user_tags YOUR_USERNAME administrator
rabbitmqctl set_permissions -p / YOUR_USERNAME ".*" ".*" ".*"

3. Установить на сервере центрального офиса инсталляционный пакет SqlPlusDbSync.Server.Setup.msi. Перейти в папку установки. 
Открыть файл Config_storage.json и установить обязательные параметры:
{
...
  "MessageServer": "localhost", // Адрес сервера. Поддерживаются NETBIOS имена, также IPv4, IPv6
  "MessageServerUserName": "user", // Имя пользователя, которого мы создали на шаге 2
  "MessageServerUserPassword": "password", // Пароль пользователя, которого мы создали на шаге 2
...
}
4. Необходимо убедиться, что в папке, куда установлен сервис обменов ЦО, лежит файл "WSkladUdl.udl"
В службах Windows должна появиться новая служба "SqlPlusDbSync.Server" её можно запустить. После этого сервис начнёт работать(базы будут обмениваться друг с другом)

5. Сервис для центрального офиса установлен.

6. Установить на сервере аптеки инсталляционный пакет SqlPlusDbSync.Client.Setup.msi. Перейти в папку установки. 
Открыть файл Config_storage.json и установить обязательные параметры:
{
...
  "MessageServer": "localhost", // Адрес сервера. Поддерживаются NETBIOS имена, также IPv4, IPv6
  "MessageServerUserName": "user", // Имя пользователя, которого мы создали на шаге 2
  "MessageServerUserPassword": "password", // Пароль пользователя, которого мы создали на шаге 2
...
}
7. Необходимо убедиться, что в папке, куда установлен сервис аптеки, лежит файл "WSkladUdl.udl"
В службах Windows должна появиться новая служба "SqlPlusDbSync.Client" её можно запустить, после этого сервис начнёт работать(базы будут обмениваться друг с другом).

8. Сервис для аптеки установлен.

9. Есть ряд дополнительных настроек для файла "Config_storage.json":
 "MaxMessageSizeInKB": 128 - Максимальный размер отправляемого сообщения в сесси в килобайтах
 "TimeoutInSeconds": 360 - Время, после которого происходит пренудительный разрыв текущей сессии обмена и попытка создать новую
 "MaxUncommitedTimeInSeconds": 120 - Время, после которого все незафиксированные объекты на удалённом узле анулируются и происходи повторная отправка данных

 10. Схема работы обменов
 Терминология
  Сервер сообщений(СС) - Сервер обеспечивающий доставку сообщений от одного узла обменов к другому
  Центральная база (ЦБ) - Консолидационная база данных, откуда выгружаются и куда поступают данные
  Подчинённый узел (ПУ) - Узел, который подчиняется главному узлу и общается с ним путём отправки сообщений обмена через СС.
 Виды сообщений
  - Запрос версии
  - Ответ на запрос версии
  - Запрос правил обмена
  - Ответ на запрос правил обмена
  - Запрос данных с версии
  - Ответ на запрос данных с версии
  - Подписаться на канал
  - Отписаться от канала
  - Отправка информации
  - Запрос обменовления
  - Обновление программы
  - Выполнить SQL
  - Результат выполения SQL
  - Перезапуск сервиса
  - Изменить конфигурацию
 
 Инифиировать сессию обмена всегда должен ПУ. При запуске клиента ПУ отправляется запрос на правила и изменения конфигурации.

 Для корректной работы обменов для объектов с пометкой TRANSFER создаются триггеры __vUpdate и __vMetadata.
 